{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@groupdocs.examples.angular/annotation/lib/annotation-config.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation-config.service.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation.service.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation-models.ts","ng://@groupdocs.examples.angular/annotation/lib/active-annotation.service.ts","ng://@groupdocs.examples.angular/annotation/lib/remove-annotation.service.ts","ng://@groupdocs.examples.angular/annotation/lib/comment-annotation.service.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation/annotation.component.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation-app.component.ts","ng://@groupdocs.examples.angular/annotation/lib/comment-panel/comment-panel.component.ts","ng://@groupdocs.examples.angular/annotation/lib/comment/comment.component.ts","ng://@groupdocs.examples.angular/annotation/lib/create-comment/create-comment.component.ts","ng://@groupdocs.examples.angular/annotation/lib/annotation.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__values","o","m","Symbol","iterator","i","call","next","length","value","done","AnnotationConfig","AnnotationConfigService","_http","_config","this","_annotationConfig","BehaviorSubject","_updatedConfig","asObservable","defineProperty","prototype","load","_this","Promise","resolve","reject","configEndpoint","getConfigEndpoint","Api","ANNOTATION_APP","get","httpOptionsJson","toPromise","then","response","annotationConfig","catch","JSON","stringify","Injectable","args","providedIn","HttpClient","ConfigService","AnnotationService","loadFiles","path","post","getAnnotationApiEndpoint","LOAD_FILE_TREE","loadFile","credentials","LOAD_DOCUMENT_DESCRIPTION","upload","file","url","rewrite","formData","FormData","append","String","UPLOAD_DOCUMENTS","loadPage","page","LOAD_DOCUMENT_PAGE","guid","password","getDownloadUrl","DOWNLOAD_ANNOTATED","annotate","annotationsData","print","data","documentType","FileUtil","find","format","ANNOTATE","AnnotationType","getAnnotationType","id","TEXT","AREA","POINT","TEXT_STRIKEOUT","POLYLINE","TEXT_FIELD","WATERMARK","TEXT_REPLACEMENT","ARROW","TEXT_REDACTION","TEXT_UNDERLINE","DISTANCE","name","icon","_super","PageAnnotationModel","__","constructor","create","tslib_1.__extends","PageModel","Position","left","top","clone","position","Dimension","width","height","isNone","AnnotationData","text","fontColor","CommentAnnotation","Comment","time","Date","now","userName","comment","ret","RemoveAnnotation","ActiveAnnotationService","_observer","Subject","_activeChange","changeActive","annId","RemoveAnnotationService","_removeAnnotation","remove","CommentAnnotationService","_commentAnnotation","_observerAddComment","_addCommentObserve","addComment","$","jquery","AnnotationComponent","_activeAnnotationService","_removeAnnotationService","_commentAnnotationService","_zoomService","active","dimension","textValue","distanceValue","pointsValue","svgPath","formatting","Formatting","default","points","activeChange","subscribe","setTextFocus","isOnPage","currentPage","document","elementFromPoint","x","y","parent","hasClass","ngOnInit","leftTop","isPolyline","parsedPoints","replace","split","x_1","parseFloat","y_1","comp_1","forEach","point","index","addPoint","isPath","type","end","setEndPosition","getDistance","initPoint","ngAfterViewInit","ngAfterViewChecked","changeZoom","zoom","activation","$event","checkDragging","correctPosition","refreshLeftTop","pageHeight","pageWidth","dragOver","preventDefault","stopPropagation","dragStart","oldPosition","Utils","getMousePosition","dataTransfer","setData","dragging","top_1","_b","tslib_1.__values","_c","endPosition","pathValue","getAnnotationClass","isStrikeoutOrUnderline","isTextReplacement","saveText","draw","onPage","calcPositionAndDimension","setStyles","stroke","stroke-width","fill-opacity","isDistance","class","Number","MAX_VALUE","rightBottom","MIN_VALUE","Math","min","max","calcDimensions","currentPosition","getHeight","undefined","abs","getWidth","isPoint","isSVG","distanceTextOptions","font-size","push","xs","ys","round","sqrt","bottom","window","location","head","getTextX","isText","getFormatting","f","fontSize","font","color","saveFormatting","getMenuShift","menuWidth","getMenuType","MenuType","FOR_ANNOTATION","setTimeout","element","focus","textAreaHeight","key","textarea","scrollHeight","scrollWidth","hideMenu","getAnnotationData","annotationData","parseInt","toHex","pageNumber","getSvgPath","previousX","previousY","Component","selector","template","ZoomService","AnnotationAppComponent","_annotationService","_modalService","_navigateService","_tabActivatorService","_hostingComponentsService","_addDynamicComponentService","uploadFilesService","pagePreloadService","passwordService","_windowService","configService","title","files","browseFilesModal","CommonModals","BrowseFiles","formatDisabled","annotationTypes","annotationTypeFirst","annotationTypeSecond","annotationTypeThird","countPages","comments","Map","_zoom","fileWasDropped","annotations","updatedConfig","isDesktop","onResize","w","refreshZoom","activeAnnotationId","commentOpenedId","commentAnnotation","set","addCommentObserve","removeAnnotation","componentRef","destroy","delete","uploadsChange","uploads","item","rewriteConfig","obj","selectFile","selectDir","checkPreload","preloadPageCountConfig","pages","preloadPages","passChange","pass","PasswordRequired","getComments","pageSelector","preloadPageCount","download","downloadOriginal","downloadAnnotated","defaultDocumentConfig","defaultDocument","browse","enableRightClick","textAnnotation","areaAnnotation","pointAnnotation","textStrikeoutAnnotation","polylineAnnotation","textFieldAnnotation","watermarkAnnotation","textReplacementAnnotation","arrowAnnotation","textRedactionAnnotation","textUnderlineAnnotation","distanceAnnotation","isLoading","ptToPx","pt","getFitToWidth","_pageWidth","_pageHeight","offsetWidth","innerWidth","zoomIn","zoomOut","openModal","open","closeModal","close","modalId","FileCredentials","cleanAnnotations","importAnnotations","clearData","start","this_1","annotations_1","annotations_1_1","annotation","addAnnotationComponent","onRightClick","enableRightClickConfig","downloadFile","assign","prepareAnnotationsData","OperationSuccess","values","isVisible","supported","supportedAnnotations","getAnnotationTypeConfig","activeTab","activeAnnotationTab","codesConfigFirst","checkConfig","codesConfigSecond","annotationList","annotationList_1","annotationList_1_1","annotationType","codesConfigThird","textAnnotationConfig","areaAnnotationConfig","pointAnnotationConfig","textStrikeoutAnnotationConfig","polylineAnnotationConfig","textFieldAnnotationConfig","watermarkAnnotationConfig","textReplacementAnnotationConfig","arrowAnnotationConfig","textRedactionAnnotationConfig","textUnderlineAnnotationConfig","distanceAnnotationConfig","fileDropped","hideAnnotations","annotationCompRef","annotationsHidden","hidden","createAnnotation","target","classList","elementsFromPoint","startsWith","documentPage","getCurrentPosition","pageId","creatingAnnotationId","dynamicDirective","viewContainerRef","annotationComponent","addDynamicComponent","getNextId","toString","pageModel","number","resizingCreatingAnnotation","offset","finishCreatingAnnotation","closeComments","onPan","maxId","keys","ModalService","NavigateService","TopTabActivatorService","HostingDynamicComponentService","AddDynamicComponentService","UploadFilesService","PagePreloadService","PasswordService","WindowService","CommentPanelComponent","EventEmitter","closePanel","emit","newComment","currentComment","annotationId","clearComment","Input","Output","CommentComponent","getTime","hours","sec","CreateCommentComponent","removeComment","onAddComment","saveName","initializeApp","annotationConfigService","setupLoadingInterceptor","service","LoadingMaskInterceptorService","AnnotationModule","library","add","fas","far","forRoot","apiEndpoint","DEFAULT_API_ENDPOINT","ngModule","NgModule","declarations","exports","CommonComponentsModule","imports","CommonModule","HttpClientModule","FontAwesomeModule","ClickOutsideModule","TranslateModule","providers","provide","HTTP_INTERCEPTORS","useClass","ErrorInterceptorService","multi","APP_INITIALIZER","useFactory","deps","LoadingMaskService","entryComponents"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export class AnnotationConfig {\r\n  rewrite: boolean;\r\n  pageSelector: boolean;\r\n  download: boolean;\r\n  upload: boolean;\r\n  print: boolean;\r\n  browse: boolean;\r\n  enableRightClick: boolean;\r\n\r\n  filesDirectory: string;\r\n  fontsDirectory: string;\r\n  defaultDocument: string;\r\n  preloadPageCount: 0;\r\n\r\n  textAnnotation: boolean;\r\n  areaAnnotation: boolean;\r\n  pointAnnotation: boolean;\r\n  textStrikeoutAnnotation: boolean;\r\n  polylineAnnotation: boolean;\r\n  textFieldAnnotation: boolean;\r\n  watermarkAnnotation: boolean;\r\n  textReplacementAnnotation: boolean;\r\n  arrowAnnotation: boolean;\r\n  textRedactionAnnotation: boolean;\r\n  textUnderlineAnnotation: boolean;\r\n  distanceAnnotation: boolean;\r\n  downloadOriginal: boolean;\r\n  downloadAnnotated: boolean;\r\n\r\n  zoom: boolean;\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {BehaviorSubject, Observable} from \"rxjs\";\r\nimport {HttpClient} from \"@angular/common/http\";\r\nimport {Api, ConfigService} from \"@groupdocs.examples.angular/common-components\";\r\nimport {AnnotationConfig} from \"./annotation-config\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AnnotationConfigService {\r\n\r\n  private _annotationConfig: BehaviorSubject<AnnotationConfig> = new BehaviorSubject(new AnnotationConfig());\r\n  private _updatedConfig: Observable<AnnotationConfig> = this._annotationConfig.asObservable();\r\n\r\n  constructor(private _http: HttpClient, private _config: ConfigService) {\r\n  }\r\n\r\n  get updatedConfig() {\r\n    return this._updatedConfig;\r\n  }\r\n\r\n  load() {\r\n    return new Promise<void>((resolve, reject) => {\r\n      const configEndpoint = this._config.getConfigEndpoint(Api.ANNOTATION_APP);\r\n      this._http.get(configEndpoint, Api.httpOptionsJson).toPromise().then((response: AnnotationConfig) => {\r\n        const annotationConfig = <AnnotationConfig>response;\r\n        this._annotationConfig.next(annotationConfig);\r\n        resolve();\r\n      }).catch((response: any) => {\r\n        reject(`Could not load annotation config: ${JSON.stringify(response)}`);\r\n      });\r\n    });\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {HttpClient} from \"@angular/common/http\";\r\nimport {Api, ConfigService, FileCredentials, FileUtil} from \"@groupdocs.examples.angular/common-components\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AnnotationService {\r\n\r\n  constructor(private _http: HttpClient, private _config: ConfigService) {\r\n  }\r\n\r\n  loadFiles(path: string) {\r\n    return this._http.post(this._config.getAnnotationApiEndpoint() + Api.LOAD_FILE_TREE, {'path': path}, Api.httpOptionsJson);\r\n  }\r\n\r\n  loadFile(credentials: FileCredentials) {\r\n    return this._http.post(this._config.getAnnotationApiEndpoint() + Api.LOAD_DOCUMENT_DESCRIPTION, credentials, Api.httpOptionsJson);\r\n  }\r\n\r\n  upload(file: File, url: string, rewrite: boolean) {\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    formData.append('rewrite', String(rewrite));\r\n    if (url) {\r\n      formData.append(\"url\", url);\r\n    }\r\n\r\n    return this._http.post(this._config.getAnnotationApiEndpoint() + Api.UPLOAD_DOCUMENTS, formData);\r\n  }\r\n\r\n  loadPage(credentials: FileCredentials, page: number) {\r\n    return this._http.post(this._config.getAnnotationApiEndpoint() + Api.LOAD_DOCUMENT_PAGE, {\r\n      'guid': credentials.guid,\r\n      'password': credentials.password,\r\n      'page': page\r\n    }, Api.httpOptionsJson);\r\n  }\r\n\r\n  getDownloadUrl(credentials: FileCredentials) {\r\n    return this._config.getAnnotationApiEndpoint() + Api.DOWNLOAD_ANNOTATED + '/?path=' + credentials.guid;\r\n  }\r\n\r\n  annotate(credentials: FileCredentials, annotationsData: any, print: boolean) {\r\n    const data = {\r\n      'guid': credentials.guid,\r\n      'password': credentials.password,\r\n      'annotationsData': annotationsData,\r\n      'documentType': FileUtil.find(credentials.guid, false).format,\r\n      'print': print\r\n    };\r\n    return this._http.post(this._config.getAnnotationApiEndpoint() + Api.ANNOTATE, data, Api.httpOptionsJson);\r\n  }\r\n}\r\n","import {PageModel} from \"@groupdocs.examples.angular/common-components\";\r\n\r\nexport class AnnotationType {\r\n  public static TEXT = {id: 'textHighlight', name: 'Text', icon: 'highlighter'};\r\n  public static AREA = {id: 'area', name: 'Area', icon: 'vector-square'};\r\n  public static POINT = {id: 'point', name: 'Point', icon: 'thumbtack'};\r\n  public static TEXT_STRIKEOUT = {id: 'textStrikeout', name: 'Text strikeout', icon: 'strikethrough',};\r\n  public static POLYLINE = {id: 'polyline', name: 'Polyline', icon: 'signature'};\r\n  public static TEXT_FIELD = {id: 'textField', name: 'Text field', icon: 'i-cursor'};\r\n  public static WATERMARK = {id: 'watermark', name: 'Watermark', icon: 'tint'};\r\n  public static TEXT_REPLACEMENT = {id: 'textReplacement', name: 'Text replacement', icon: 'edit'};\r\n  public static ARROW = {id: 'arrow', name: 'Arrow', icon: 'mouse-pointer'};\r\n  public static TEXT_REDACTION = {id: 'textRedaction', name: 'Text redaction', icon: 'brush'};\r\n  public static TEXT_UNDERLINE = {id: 'textUnderline', name: 'Text underline', icon: 'underline'};\r\n  public static DISTANCE = {id: 'distance', name: 'Distance', icon: 'ruler'};\r\n\r\n  public static getAnnotationType(id: string) {\r\n    switch (id) {\r\n      case AnnotationType.TEXT.id:\r\n        return AnnotationType.TEXT;\r\n      case AnnotationType.AREA.id:\r\n        return AnnotationType.AREA;\r\n      case AnnotationType.POINT.id:\r\n        return AnnotationType.POINT;\r\n      case AnnotationType.TEXT_STRIKEOUT.id:\r\n        return AnnotationType.TEXT_STRIKEOUT;\r\n      case AnnotationType.POLYLINE.id:\r\n        return AnnotationType.POLYLINE;\r\n      case AnnotationType.TEXT_FIELD.id:\r\n        return AnnotationType.TEXT_FIELD;\r\n      case AnnotationType.WATERMARK.id:\r\n        return AnnotationType.WATERMARK;\r\n      case AnnotationType.TEXT_REPLACEMENT.id:\r\n        return AnnotationType.TEXT_REPLACEMENT;\r\n      case AnnotationType.ARROW.id:\r\n        return AnnotationType.ARROW;\r\n      case AnnotationType.TEXT_REDACTION.id:\r\n        return AnnotationType.TEXT_REDACTION;\r\n      case AnnotationType.TEXT_UNDERLINE.id:\r\n        return AnnotationType.TEXT_UNDERLINE;\r\n      case AnnotationType.DISTANCE.id:\r\n        return AnnotationType.DISTANCE;\r\n    }\r\n  }\r\n}\r\n\r\nexport class FileAnnotationDescription {\r\n  guid: string;\r\n  pages: PageAnnotationModel[];\r\n  supportedAnnotations: string[];\r\n}\r\n\r\nexport class PageAnnotationModel extends PageModel {\r\n  annotations: AnnotationData[];\r\n}\r\n\r\nexport class Position {\r\n  left: number;\r\n  top: number;\r\n\r\n  constructor(left: number, top: number) {\r\n    this.left = left;\r\n    this.top = top;\r\n  }\r\n\r\n  static clone(position: Position) {\r\n    return new Position(position.left, position.top);\r\n  }\r\n}\r\n\r\nexport class Dimension {\r\n  width: number;\r\n  height: number;\r\n\r\n  constructor(width: number, height: number) {\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  isNone() {\r\n    return this.width === 0 && this.height === 0;\r\n  }\r\n}\r\n\r\nexport class AnnotationData {\r\n\r\n  constructor() {\r\n    this.text = \"\";\r\n    this.fontColor = 8421375;\r\n  }\r\n\r\n  id: number;\r\n  comments: Comment[];\r\n  text: string;\r\n  font: string;\r\n  fontSize: number;\r\n  fontColor: number;\r\n  height: number;\r\n  width: number;\r\n  left: number;\r\n  top: number;\r\n  pageNumber: number;\r\n  svgPath: string;\r\n  type: string;\r\n}\r\n\r\nexport class CommentAnnotation {\r\n  constructor(id: number) {\r\n    this.id = id;\r\n  }\r\n\r\n  id: number;\r\n}\r\n\r\nexport class Comment {\r\n\r\n  id: number;\r\n  text: string;\r\n  userName: string;\r\n  time: number;\r\n\r\n  constructor(id: number) {\r\n    this.id = id;\r\n    this.time = Date.now();\r\n    this.text = \"\";\r\n    this.userName = \"\";\r\n  }\r\n\r\n  static create(comment) {\r\n    const ret = new Comment(comment.id);\r\n    ret.text = comment.text;\r\n    ret.userName = comment.userName;\r\n    ret.time = comment.time;\r\n    return ret;\r\n  }\r\n}\r\n\r\nexport class RemoveAnnotation {\r\n  constructor(id: number) {\r\n    this.id = id;\r\n  }\r\n\r\n  id: number;\r\n}\r\n","import {Observable, Subject} from \"rxjs\";\r\n\r\nexport class ActiveAnnotationService {\r\n  private _observer: Subject<number> = new Subject();\r\n  private readonly _activeChange: Observable<number> = this._observer.asObservable();\r\n\r\n  constructor() {\r\n  }\r\n\r\n  get activeChange(): Observable<number> {\r\n    return this._activeChange;\r\n  }\r\n\r\n  changeActive(annId: number) {\r\n    this._observer.next(annId);\r\n  }\r\n}\r\n\r\n","import {Observable, Subject} from \"rxjs\";\r\nimport {RemoveAnnotation} from \"./annotation-models\";\r\n\r\nexport class RemoveAnnotationService {\r\n  private _observer: Subject<RemoveAnnotation> = new Subject();\r\n  private readonly _removeAnnotation: Observable<RemoveAnnotation> = this._observer.asObservable();\r\n\r\n  constructor() {\r\n  }\r\n\r\n  get removeAnnotation(): Observable<RemoveAnnotation> {\r\n    return this._removeAnnotation;\r\n  }\r\n\r\n  remove(id: RemoveAnnotation): void {\r\n    this._observer.next(id);\r\n  }\r\n}\r\n","import {Observable, Subject} from \"rxjs\";\r\nimport {CommentAnnotation, Comment} from \"./annotation-models\";\r\n\r\nexport class CommentAnnotationService {\r\n  private _observer: Subject<CommentAnnotation> = new Subject();\r\n  private readonly _commentAnnotation: Observable<CommentAnnotation> = this._observer.asObservable();\r\n  private _observerAddComment: Subject<Comment> = new Subject();\r\n  private readonly _addCommentObserve: Observable<Comment> = this._observerAddComment.asObservable();\r\n\r\n  constructor() {\r\n  }\r\n\r\n  get commentAnnotation(): Observable<CommentAnnotation> {\r\n    return this._commentAnnotation;\r\n  }\r\n\r\n  comment(id: CommentAnnotation): void {\r\n    this._observer.next(id);\r\n  }\r\n\r\n  get addCommentObserve(): Observable<Comment> {\r\n    return this._addCommentObserve;\r\n  }\r\n\r\n  addComment(comment: Comment) {\r\n    this._observerAddComment.next(comment);\r\n  }\r\n\r\n}\r\n","import {AfterViewInit, Component, OnInit, AfterViewChecked} from '@angular/core';\r\nimport {\r\n  AnnotationData,\r\n  AnnotationType,\r\n  CommentAnnotation,\r\n  Dimension,\r\n  Position,\r\n  RemoveAnnotation\r\n} from \"../annotation-models\";\r\nimport {ActiveAnnotationService} from \"../active-annotation.service\";\r\nimport {Formatting, Utils, MenuType, ZoomService} from \"@groupdocs.examples.angular/common-components\";\r\nimport {RemoveAnnotationService} from \"../remove-annotation.service\";\r\nimport {CommentAnnotationService} from \"../comment-annotation.service\";\r\nimport * as jquery from 'jquery';\r\n\r\nconst $ = jquery;\r\n\r\n@Component({\r\n  selector: 'gd-annotation',\r\n  templateUrl: './annotation.component.html',\r\n  styleUrls: ['./annotation.component.less']\r\n})\r\nexport class AnnotationComponent implements OnInit, AfterViewInit, AfterViewChecked {\r\n\r\n  id: number;\r\n  position: Position;\r\n  leftTop: Position;\r\n  type: string;\r\n  pageWidth: number;\r\n  pageHeight: number;\r\n  active = true;\r\n  dimension = new Dimension(0, 0);\r\n  pageNumber: number;\r\n  textValue = \"\";\r\n  pathValue: string;\r\n  distanceValue = '0px';\r\n  pointsValue = \"\";\r\n  svgPath = \"\";\r\n  formatting = Formatting.default();\r\n  hidden: boolean;\r\n\r\n  private oldPosition: { x: number; y: number };\r\n  private points = [];\r\n  private endPosition: Position;\r\n\r\n  constructor(private _activeAnnotationService: ActiveAnnotationService,\r\n              private _removeAnnotationService: RemoveAnnotationService,\r\n              private _commentAnnotationService: CommentAnnotationService,\r\n              private _zoomService: ZoomService) {\r\n    this._activeAnnotationService.activeChange.subscribe((id: number) => {\r\n      this.active = this.id === id;\r\n      if (this.active) {\r\n        this.setTextFocus();\r\n      }\r\n    });\r\n  }\r\n\r\n  static isOnPage(position) {\r\n    const currentPage = document.elementFromPoint(position.x, position.y);\r\n    return currentPage && $(currentPage).parent().parent() &&\r\n      ($(currentPage).parent().parent().parent().hasClass(\"page\") ||\r\n        $(currentPage).parent().parent().parent().parent().parent().hasClass(\"page\"));\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.leftTop = Position.clone(this.position);\r\n    if (this.isPolyline()) {\r\n      if (this.svgPath) {\r\n        const parsedPoints = this.svgPath.replace(\"M\", \"\").split('L');\r\n        let x = parseFloat(parsedPoints[0].split(\",\")[0]);\r\n        let y = parseFloat(parsedPoints[0].split(\",\")[1]);\r\n        const comp = this;\r\n        parsedPoints.forEach(function (point, index) {\r\n          if (index !== 0) {\r\n            if (point !== \"\") {\r\n              comp.addPoint(new Position(x, y));\r\n              x = (x + parseFloat(point.split(\",\")[0]));\r\n              y = (y + parseFloat(point.split(\",\")[1]));\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        this.addPoint(this.position);\r\n      }\r\n    } else if (this.isPath()) {\r\n      if (this.svgPath || (this.type === AnnotationType.ARROW.id && !this.dimension.isNone())) {\r\n        const end = new Position(this.position.left + this.dimension.width, this.position.top + this.dimension.height);\r\n        this.setEndPosition(end);\r\n        if (this.dimension.height < 0) {\r\n          this.leftTop.top += this.dimension.height;\r\n          this.dimension.height = this.dimension.height * (-1);\r\n        }\r\n        if (this.dimension.width < 0) {\r\n          this.leftTop.left += this.dimension.width;\r\n          this.dimension.width = this.dimension.width * (-1);\r\n        }\r\n      } else {\r\n        this.setEndPosition(this.position);\r\n      }\r\n      this.distanceValue = this.getDistance() + \"px\";\r\n    } else if (this.type === AnnotationType.POINT.id) {\r\n      this.initPoint();\r\n    } else {\r\n      this.setEndPosition(this.position);\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.setTextFocus();\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    this._zoomService.changeZoom(this._zoomService.zoom);\r\n  }\r\n\r\n  activation() {\r\n    this._activeAnnotationService.changeActive(this.id);\r\n  }\r\n\r\n  width($event) {\r\n    if (this.checkDragging($event, 0)) {\r\n      this.dimension.width += $event;\r\n    }\r\n  }\r\n\r\n  height($event) {\r\n    if (this.checkDragging(0, $event)) {\r\n      this.dimension.height += $event;\r\n    }\r\n  }\r\n\r\n  left($event) {\r\n    this.position.left += $event;\r\n    this.correctPosition();\r\n    this.refreshLeftTop();\r\n  }\r\n\r\n  top($event) {\r\n    this.position.top += $event;\r\n    this.correctPosition();\r\n    this.refreshLeftTop();\r\n  }\r\n\r\n  private refreshLeftTop() {\r\n    this.leftTop.left = this.position.left;\r\n    this.leftTop.top = this.position.top;\r\n  }\r\n\r\n  private correctPosition() {\r\n    if (this.position.left < 0) {\r\n      this.position.left = 0;\r\n    }\r\n    if (this.position.top < 0) {\r\n      this.position.top = 0;\r\n    }\r\n    if (this.position.top + this.dimension.height > this.pageHeight) {\r\n      this.position.top = this.pageHeight - this.dimension.height;\r\n    }\r\n    if (this.position.left + this.dimension.width > this.pageWidth) {\r\n      this.position.left = this.pageWidth - this.dimension.width;\r\n    }\r\n  }\r\n\r\n  dragOver($event: DragEvent) {\r\n    $event.preventDefault();\r\n    $event.stopPropagation();\r\n  }\r\n\r\n  dragStart($event: DragEvent) {\r\n    $event.preventDefault();\r\n    this.oldPosition = Utils.getMousePosition($event);\r\n    if ($event.dataTransfer) {\r\n      $event.dataTransfer.setData('text', 'foo');\r\n    }\r\n  }\r\n\r\n  initPoint() {\r\n    this.dimension = new Dimension(40, 40);\r\n    this.position.left = this.position.left - 20;\r\n    this.position.top = this.position.top - 20;\r\n    this.leftTop = Position.clone(this.position);\r\n  }\r\n\r\n  dragging($event) {\r\n    $event.preventDefault();\r\n    const position = Utils.getMousePosition($event);\r\n    if (position.x && position.y && AnnotationComponent.isOnPage(position)) {\r\n      const left = position.x - this.oldPosition.x;\r\n      const top = position.y - this.oldPosition.y;\r\n      if (this.isPolyline()) {\r\n        if (!this.checkDragging(left, top)) {\r\n          return;\r\n        }\r\n        this.pointsValue = \"\";\r\n        for (const point of this.points) {\r\n          point.left = point.left + left;\r\n          point.top = point.top + top;\r\n          this.pointsValue += point.left + \",\" + point.top + \" \";\r\n        }\r\n        this.leftTop.left += left;\r\n        this.leftTop.top += top;\r\n      } else if (this.isPath()) {\r\n        if (!this.checkDragging(left, top)) {\r\n          return;\r\n        }\r\n        this.position.left += left;\r\n        this.position.top += top;\r\n        this.endPosition.left += left;\r\n        this.endPosition.top += top;\r\n        this.pathValue = \"M\" + this.position.left + \",\" + this.position.top + \" L\" + this.endPosition.left + \",\" + this.endPosition.top;\r\n        this.distanceValue = this.getDistance() + \"px\";\r\n        this.leftTop.left += left;\r\n        this.leftTop.top += top;\r\n      } else {\r\n        this.position.left += left;\r\n        this.position.top += top;\r\n        this.correctPosition();\r\n        this.refreshLeftTop();\r\n      }\r\n      this.oldPosition = position;\r\n    }\r\n  }\r\n\r\n  getAnnotationClass() {\r\n    switch (this.type) {\r\n      case AnnotationType.TEXT.id:\r\n        return \"gd-annotation-wrapper-border gd-text-annotation\";\r\n      case AnnotationType.TEXT_STRIKEOUT.id:\r\n        return \"gd-annotation-wrapper-border gd-text-annotation gd-text-strikeout-annotation\";\r\n      case AnnotationType.TEXT_UNDERLINE.id:\r\n        return \"gd-annotation-wrapper-border gd-text-annotation gd-text-underline-annotation\";\r\n      case AnnotationType.TEXT_REDACTION.id:\r\n        return \"gd-annotation-wrapper-border gd-text-redaction-annotation\";\r\n      case AnnotationType.TEXT_REPLACEMENT.id:\r\n      case AnnotationType.TEXT_FIELD.id:\r\n      case AnnotationType.WATERMARK.id:\r\n        return \"gd-annotation-wrapper-border gd-text-replacement-annotation\";\r\n      case AnnotationType.POINT.id:\r\n        return \"\";\r\n      default:\r\n        return \"gd-annotation-wrapper-border\";\r\n    }\r\n  }\r\n\r\n  isStrikeoutOrUnderline() {\r\n    return this.type === AnnotationType.TEXT_STRIKEOUT.id || this.type === AnnotationType.TEXT_UNDERLINE.id;\r\n  }\r\n\r\n  isTextReplacement() {\r\n    return this.type === AnnotationType.TEXT_REPLACEMENT.id;\r\n  }\r\n\r\n  saveText(value: string) {\r\n    this.textValue = value;\r\n  }\r\n\r\n  draw(position: Position) {\r\n    if (this.onPage(position)) {\r\n      if (this.isPolyline()) {\r\n        this.addPoint(position);\r\n      } else if (this.isPath()) {\r\n        this.setEndPosition(position);\r\n        this.distanceValue = this.getDistance() + \"px\";\r\n      }\r\n      this.calcPositionAndDimension();\r\n    }\r\n  }\r\n\r\n  setStyles() {\r\n    return {\r\n      'stroke': '#579AF0',\r\n      'stroke-width': 2,\r\n      'fill-opacity': 0,\r\n      'id': (this.isPolyline() ? 'gd-polyline-annotation-' : (this.isDistance() ? 'gd-distance-annotation-' : 'gd-arrow-annotation-')) + this.id,\r\n      'class': 'annotation-svg',\r\n    };\r\n  }\r\n\r\n  isPolyline() {\r\n    return this.type === AnnotationType.POLYLINE.id;\r\n  }\r\n\r\n  private calcPositionAndDimension() {\r\n    const leftTop = new Position(Number.MAX_VALUE, Number.MAX_VALUE);\r\n    const rightBottom = new Position(Number.MIN_VALUE, Number.MIN_VALUE);\r\n    if (this.isPolyline()) {\r\n      for (const point of this.points) {\r\n        leftTop.left = Math.min(point.left, leftTop.left);\r\n        leftTop.top = Math.min(point.top, leftTop.top);\r\n        rightBottom.left = Math.max(point.left, rightBottom.left);\r\n        rightBottom.top = Math.max(point.top, rightBottom.top);\r\n      }\r\n    } else {\r\n      leftTop.left = Math.min(this.position.left, this.endPosition.left);\r\n      leftTop.top = Math.min(this.position.top, this.endPosition.top);\r\n      rightBottom.left = Math.max(this.position.left, this.endPosition.left);\r\n      rightBottom.top = Math.max(this.position.top, this.endPosition.top);\r\n    }\r\n    this.dimension.width = rightBottom.left - leftTop.left;\r\n    this.dimension.height = rightBottom.top - leftTop.top;\r\n    this.leftTop = leftTop;\r\n  }\r\n\r\n  calcDimensions(currentPosition: Position) {\r\n    if (currentPosition.left <= this.pageWidth && currentPosition.left >= 0) {\r\n      this.dimension.width = currentPosition.left - this.position.left;\r\n    }\r\n    if (currentPosition.top <= this.pageHeight && currentPosition.top >= 0) {\r\n      this.dimension.height = currentPosition.top - this.position.top;\r\n    }\r\n  }\r\n\r\n  getHeight() {\r\n    return this.dimension.height === undefined ? undefined : Math.abs(this.dimension.height);\r\n  }\r\n\r\n  getWidth() {\r\n    return this.dimension.width === undefined ? undefined : Math.abs(this.dimension.width);\r\n  }\r\n\r\n  private checkDragging(left: number, top: number) {\r\n    return !(this.leftTop.left + left < 0 || this.leftTop.top + top < 0 ||\r\n      this.leftTop.top + top + this.dimension.height > this.pageHeight ||\r\n      this.leftTop.left + left + this.dimension.width > this.pageWidth);\r\n  }\r\n\r\n  isPoint() {\r\n    return this.type === AnnotationType.POINT.id;\r\n  }\r\n\r\n  isSVG() {\r\n    return this.type === AnnotationType.POLYLINE.id ||\r\n      this.type === AnnotationType.DISTANCE.id ||\r\n      this.type === AnnotationType.ARROW.id;\r\n  }\r\n\r\n  isDistance() {\r\n    return this.type === AnnotationType.DISTANCE.id;\r\n  }\r\n\r\n  distanceTextOptions() {\r\n    return {'font-size': \"12px\"}\r\n  }\r\n\r\n  isPath() {\r\n    return this.type === AnnotationType.DISTANCE.id ||\r\n      this.type === AnnotationType.ARROW.id;\r\n  }\r\n\r\n  private setEndPosition(position: Position) {\r\n    this.endPosition = Position.clone(position);\r\n    this.pathValue = \"M\" + this.position.left + \",\" + this.position.top + \" L\" + this.endPosition.left + \",\" + this.endPosition.top;\r\n  }\r\n\r\n  private addPoint(position: Position) {\r\n    this.points.push(position);\r\n    this.pointsValue += position.left + \",\" + position.top + \" \";\r\n  }\r\n\r\n  private getDistance() {\r\n    const xs = this.position.left - this.endPosition.left;\r\n    const ys = this.position.top - this.endPosition.top;\r\n    return Math.round(Math.sqrt(xs * xs + ys * ys));\r\n  }\r\n\r\n  bottom() {\r\n    return 'url(' + window.location + '#end)';\r\n  }\r\n\r\n  head() {\r\n    return this.isDistance() ? 'url(' + window.location + '#start)' : \"\";\r\n  }\r\n\r\n  getTextX() {\r\n    return this.getDistance() / 2;\r\n  }\r\n\r\n  isText() {\r\n    return this.type === AnnotationType.TEXT_FIELD.id || this.type === AnnotationType.WATERMARK.id;\r\n  }\r\n\r\n  getFormatting() {\r\n    const f = this.formatting;\r\n    const formatting = Formatting.default();\r\n    if (f) {\r\n      formatting.fontSize = f.fontSize;\r\n      formatting.font = f.font;\r\n      formatting.color = f.color;\r\n    }\r\n    return formatting;\r\n  }\r\n\r\n  saveFormatting($event: Formatting) {\r\n    this.formatting.fontSize = $event.fontSize;\r\n    this.formatting.font = $event.font;\r\n    this.formatting.color = $event.color;\r\n  }\r\n\r\n  remove() {\r\n    this._removeAnnotationService.remove(new RemoveAnnotation(this.id));\r\n  }\r\n\r\n  getMenuShift() {\r\n    const menuWidth = this.isText() ? 265 : 111;\r\n    return this.dimension.width > menuWidth ? 0 : (this.dimension.width - menuWidth) * 0.5;\r\n  }\r\n\r\n  getMenuType() {\r\n    return MenuType.FOR_ANNOTATION;\r\n  }\r\n\r\n  addComment() {\r\n    this._commentAnnotationService.comment(new CommentAnnotation(this.id));\r\n  }\r\n\r\n  private setTextFocus() {\r\n    if (this.isText() || this.isTextReplacement()) {\r\n      setTimeout(() => {\r\n        const element = $(\"#text-\" + this.id);\r\n        if (element) {\r\n          element.focus();\r\n        }\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  textAreaHeight(key: any, textarea: any) {\r\n    this.dimension.height = \"Enter\" === key ? textarea.scrollHeight + this.formatting.fontSize : textarea.scrollHeight;\r\n    this.dimension.width = textarea.scrollWidth;\r\n  }\r\n\r\n  hideMenu($event: Event) {\r\n    this._activeAnnotationService.changeActive(null);\r\n  }\r\n\r\n  getAnnotationData(): AnnotationData {\r\n    const annotationData = new AnnotationData();\r\n    annotationData.id = this.id;\r\n    annotationData.text = this.textValue;\r\n    annotationData.fontColor = parseInt(Utils.toHex(this.formatting.color).replace(\"#\", \"\"), 16);\r\n    annotationData.fontSize = this.formatting.fontSize;\r\n    annotationData.font = this.formatting.font;\r\n    if (this.type === AnnotationType.POINT.id) {\r\n      annotationData.left = this.leftTop.left + 20;\r\n      annotationData.top = this.leftTop.top + 20;\r\n      annotationData.height = 0;\r\n      annotationData.width = 0;\r\n    } else {\r\n      annotationData.left = this.leftTop.left;\r\n      annotationData.top = this.leftTop.top;\r\n      annotationData.height = this.dimension.height;\r\n      annotationData.width = this.dimension.width;\r\n    }\r\n    annotationData.pageNumber = this.pageNumber;\r\n    annotationData.type = this.type;\r\n    annotationData.svgPath = this.getSvgPath();\r\n    return annotationData;\r\n  }\r\n\r\n  private getSvgPath() {\r\n    let svgPath = \"M\";\r\n    if (this.type === AnnotationType.POLYLINE.id) {\r\n      let index = 0;\r\n      let previousX = 0, previousY = 0;\r\n      for (const point of this.points) {\r\n        if (index === 0) {\r\n          svgPath += point.left + \",\" + point.top + \"l\";\r\n          index = 1;\r\n        } else {\r\n          previousX = point.left - previousX;\r\n          previousY = point.top - previousY;\r\n          svgPath += previousX + \",\" + previousY + \"l\";\r\n        }\r\n        previousX = point.left;\r\n        previousY = point.top;\r\n      }\r\n    } else if (this.type === AnnotationType.DISTANCE.id || this.type === AnnotationType.ARROW.id) {\r\n      svgPath += this.position.left + \",\" + this.position.top + \" \";\r\n      svgPath += this.endPosition.left + \",\" + this.endPosition.top + \" \";\r\n    } else {\r\n      svgPath = \"\";\r\n    }\r\n    return svgPath;\r\n  }\r\n\r\n  private onPage(position: Position) {\r\n    return position.left <= this.pageWidth && position.top <= this.pageHeight &&\r\n      position.left >= 0 && position.top >= 0;\r\n  }\r\n}\r\n","import { Component, ComponentRef, OnInit } from '@angular/core';\r\nimport { AnnotationConfig } from \"./annotation-config\";\r\nimport { AnnotationService } from \"./annotation.service\";\r\nimport {\r\n  AddDynamicComponentService,\r\n  CommonModals,\r\n  FileCredentials,\r\n  FileModel, Formatting,\r\n  HostingDynamicComponentService,\r\n  ModalService,\r\n  NavigateService, PagePreloadService, PasswordService,\r\n  TopTabActivatorService, UploadFilesService,\r\n  Utils,\r\n  WindowService,\r\n  ZoomService\r\n} from \"@groupdocs.examples.angular/common-components\";\r\nimport {\r\n  AnnotationType,\r\n  CommentAnnotation,\r\n  Position,\r\n  RemoveAnnotation,\r\n  Comment,\r\n  FileAnnotationDescription, PageAnnotationModel, AnnotationData, Dimension\r\n} from \"./annotation-models\";\r\nimport { AnnotationComponent } from \"./annotation/annotation.component\";\r\nimport { ActiveAnnotationService } from \"./active-annotation.service\";\r\nimport * as jquery from 'jquery';\r\nimport { RemoveAnnotationService } from \"./remove-annotation.service\";\r\nimport { CommentAnnotationService } from \"./comment-annotation.service\";\r\nimport { AnnotationConfigService } from \"./annotation-config.service\";\r\n\r\nconst $ = jquery;\r\n\r\n@Component({\r\n  selector: 'gd-annotation-app',\r\n  templateUrl: './annotation-app.component.html',\r\n  styleUrls: ['./annotation-app.component.less']\r\n})\r\nexport class AnnotationAppComponent implements OnInit {\r\n  title = 'annotation';\r\n  files: FileModel[] = [];\r\n  file: FileAnnotationDescription;\r\n  isLoading: boolean;\r\n  annotationConfig: AnnotationConfig;\r\n  browseFilesModal = CommonModals.BrowseFiles;\r\n  formatDisabled = !this.file;\r\n  public credentials: FileCredentials;\r\n  annotationTypes = [\r\n    AnnotationType.TEXT,\r\n    AnnotationType.TEXT_STRIKEOUT,\r\n    AnnotationType.TEXT_UNDERLINE,\r\n    AnnotationType.TEXT_REPLACEMENT,\r\n    AnnotationType.TEXT_REDACTION,\r\n    AnnotationType.POLYLINE,\r\n    AnnotationType.ARROW,\r\n    AnnotationType.DISTANCE,\r\n    AnnotationType.AREA,\r\n    AnnotationType.TEXT_FIELD,\r\n    AnnotationType.WATERMARK,\r\n    AnnotationType.POINT,\r\n  ];\r\n  isDesktop: boolean;\r\n  annotationTypeFirst = [\r\n    AnnotationType.TEXT,\r\n    AnnotationType.TEXT_UNDERLINE,\r\n    AnnotationType.TEXT_REDACTION,\r\n    AnnotationType.TEXT_REPLACEMENT,\r\n    AnnotationType.TEXT_STRIKEOUT,\r\n  ];\r\n  annotationTypeSecond = [\r\n    AnnotationType.POLYLINE,\r\n    AnnotationType.ARROW,\r\n    AnnotationType.DISTANCE,\r\n    AnnotationType.AREA,\r\n    AnnotationType.POINT\r\n  ];\r\n  annotationTypeThird = [\r\n    AnnotationType.TEXT_FIELD,\r\n    AnnotationType.WATERMARK,\r\n  ];\r\n  countPages = 0;\r\n  commentOpenedId: number;\r\n  comments = new Map<number, Comment[]>();\r\n  _zoom = 100;\r\n  _pageWidth: number;\r\n  _pageHeight: number;\r\n\r\n  private activeAnnotationTab: string;\r\n  private fileWasDropped = false;\r\n  public annotations = new Map<number, ComponentRef<any>>();\r\n  private creatingAnnotationId: number;\r\n  private activeAnnotationId: number;\r\n  annotationsHidden: boolean;\r\n\r\n  constructor(private _annotationService: AnnotationService,\r\n    private _modalService: ModalService,\r\n    private _navigateService: NavigateService,\r\n    private _tabActivatorService: TopTabActivatorService,\r\n    private _hostingComponentsService: HostingDynamicComponentService,\r\n    private _addDynamicComponentService: AddDynamicComponentService,\r\n    private _activeAnnotationService: ActiveAnnotationService,\r\n    private _removeAnnotationService: RemoveAnnotationService,\r\n    public _commentAnnotationService: CommentAnnotationService,\r\n    uploadFilesService: UploadFilesService,\r\n    pagePreloadService: PagePreloadService,\r\n    passwordService: PasswordService,\r\n    private _windowService: WindowService,\r\n    private _zoomService: ZoomService,\r\n    configService: AnnotationConfigService) {\r\n\r\n    configService.updatedConfig.subscribe((annotationConfig) => {\r\n      this.annotationConfig = annotationConfig;\r\n    });\r\n\r\n    this.isDesktop = _windowService.isDesktop();\r\n    _windowService.onResize.subscribe((w) => {\r\n      this.isDesktop = _windowService.isDesktop();\r\n      if (!this.isDesktop) {\r\n        this.refreshZoom();\r\n      }\r\n    });\r\n\r\n    this._activeAnnotationService.activeChange.subscribe((id: number) => {\r\n      if (this.activeAnnotationId !== id) {\r\n        this.commentOpenedId = null;\r\n        this.activeAnnotationId = id;\r\n      }\r\n    });\r\n\r\n    this._commentAnnotationService.commentAnnotation.subscribe((commentAnnotation: CommentAnnotation) => {\r\n      this.commentOpenedId = commentAnnotation.id;\r\n      if (!this.comments.get(this.commentOpenedId)) {\r\n        this.comments.set(this.commentOpenedId, []);\r\n      }\r\n    });\r\n\r\n    this._commentAnnotationService.addCommentObserve.subscribe((comment: Comment) => {\r\n      this.comments.get(this.commentOpenedId).push(comment);\r\n    });\r\n\r\n    this._removeAnnotationService.removeAnnotation.subscribe((removeAnnotation: RemoveAnnotation) => {\r\n      const componentRef = this.annotations.get(removeAnnotation.id);\r\n      if (componentRef) {\r\n        componentRef.destroy();\r\n      }\r\n      this.annotations.delete(removeAnnotation.id);\r\n      if (this.commentOpenedId === removeAnnotation.id) {\r\n        this.commentOpenedId = null;\r\n      }\r\n      this.comments.delete(removeAnnotation.id);\r\n    });\r\n\r\n    uploadFilesService.uploadsChange.subscribe((uploads) => {\r\n      if (uploads) {\r\n        let i: number;\r\n        for (i = 0; i < uploads.length; i++) {\r\n          this._annotationService.upload(uploads.item(i), '', this.rewriteConfig).subscribe((obj: FileCredentials) => {\r\n            this.fileWasDropped ? this.selectFile(obj.guid, '', '') : this.selectDir('');\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    pagePreloadService.checkPreload.subscribe((page: number) => {\r\n      if (this.preloadPageCountConfig !== 0) {\r\n        for (let i = page; i < page + 2; i++) {\r\n          if (i > 0 && i <= this.countPages && !this.file.pages[i - 1].data) {\r\n            this.preloadPages(i, i);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    passwordService.passChange.subscribe((pass: string) => {\r\n      this.selectFile(this.credentials.guid, pass, CommonModals.PasswordRequired);\r\n    });\r\n\r\n    this.isDesktop = _windowService.isDesktop();\r\n    _windowService.onResize.subscribe((w) => {\r\n      this.isDesktop = _windowService.isDesktop();\r\n    });\r\n  }\r\n\r\n  getComments() {\r\n    return this.comments.get(this.commentOpenedId);\r\n  }\r\n\r\n  get rewriteConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.rewrite : true;\r\n  }\r\n\r\n  get zoomConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.zoom : false;\r\n  }\r\n\r\n  get pageSelectorConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.pageSelector : true;\r\n  }\r\n\r\n  get preloadPageCountConfig(): number {\r\n    return this.annotationConfig ? this.annotationConfig.preloadPageCount : 0;\r\n  }\r\n\r\n  get downloadConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.download : true;\r\n  }\r\n\r\n  get downloadOriginalConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.downloadOriginal : true;\r\n  }\r\n\r\n  get downloadAnnotatedConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.downloadAnnotated : true;\r\n  }\r\n\r\n  get uploadConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.upload : true;\r\n  }\r\n\r\n  private defaultDocumentConfig() {\r\n    return this.annotationConfig ? this.annotationConfig.defaultDocument : \"\";\r\n  }\r\n\r\n  get printConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.print : true;\r\n  }\r\n\r\n  get browseConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.browse : true;\r\n  }\r\n\r\n  get htmlModeConfig(): boolean {\r\n    return false;\r\n  }\r\n\r\n  get enableRightClickConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.enableRightClick : true;\r\n  }\r\n\r\n  get textAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textAnnotation : true;\r\n  }\r\n\r\n  get areaAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.areaAnnotation : true;\r\n  }\r\n\r\n  get pointAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.pointAnnotation : true;\r\n  }\r\n\r\n  get textStrikeoutAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textStrikeoutAnnotation : true;\r\n  }\r\n\r\n  get polylineAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.polylineAnnotation : true;\r\n  }\r\n\r\n  get textFieldAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textFieldAnnotation : true;\r\n  }\r\n\r\n  get watermarkAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.watermarkAnnotation : true;\r\n  }\r\n\r\n  get textReplacementAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textReplacementAnnotation : true;\r\n  }\r\n\r\n  get arrowAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.arrowAnnotation : true;\r\n  }\r\n\r\n  get textRedactionAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textRedactionAnnotation : true;\r\n  }\r\n\r\n  get textUnderlineAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.textUnderlineAnnotation : true;\r\n  }\r\n\r\n  get distanceAnnotationConfig(): boolean {\r\n    return this.annotationConfig ? this.annotationConfig.distanceAnnotation : true;\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.annotationConfig.defaultDocument !== \"\") {\r\n      this.isLoading = true;\r\n      this.selectFile(this.annotationConfig.defaultDocument, \"\", \"\");\r\n    }\r\n  }\r\n\r\n  private ptToPx(pt: number) {\r\n    //pt * 96 / 72 = px.\r\n    return pt * 96 / 72;\r\n  }\r\n\r\n  private getFitToWidth() {\r\n    // Images and Excel-related files receiving dimensions in px from server\r\n    const pageWidth = this.ptToPx(this._pageWidth);\r\n    const pageHeight = this.ptToPx(this._pageHeight);\r\n    const offsetWidth = pageWidth ? pageWidth : window.innerWidth;\r\n\r\n    return (pageHeight > pageWidth && Math.round(offsetWidth / window.innerWidth) < 2) ? 200 - Math.round(offsetWidth * 100 / window.innerWidth) : Math.round(window.innerWidth * 100 / offsetWidth);\r\n  }\r\n\r\n  set zoom(zoom) {\r\n    this._zoom = zoom;\r\n    this._zoomService.changeZoom(this._zoom);\r\n  }\r\n\r\n  get zoom() {\r\n    return this._zoom;\r\n  }\r\n\r\n  private refreshZoom() {\r\n    this.zoom = this._windowService.isDesktop() ? 100 : this.getFitToWidth();\r\n  }\r\n\r\n  zoomIn() {\r\n    if (this.formatDisabled)\r\n      return;\r\n    if (this._zoom < 490) {\r\n      this.zoom = this._zoom + 10;\r\n    }\r\n  }\r\n\r\n  zoomOut() {\r\n    if (this.formatDisabled)\r\n      return;\r\n    if (this._zoom > 30) {\r\n      this.zoom = this._zoom - 10;\r\n    }\r\n  }\r\n\r\n  openModal(id: string) {\r\n    this._modalService.open(id);\r\n  }\r\n\r\n  closeModal(id: string) {\r\n    this._modalService.close(id);\r\n  }\r\n\r\n  selectDir($event: string) {\r\n    this._annotationService.loadFiles($event).subscribe((files: FileModel[]) => this.files = files || []);\r\n  }\r\n\r\n  selectFile($event: string, password: string, modalId: string) {\r\n    this.credentials = new FileCredentials($event, password);\r\n    this.file = null;\r\n    this.commentOpenedId = null;\r\n    this._annotationService.loadFile(this.credentials).subscribe((file: FileAnnotationDescription) => {\r\n      this.cleanAnnotations();\r\n      this.file = file;\r\n      this.formatDisabled = !this.file;\r\n      if (file) {\r\n        if (!this.isDesktop && file.pages && file.pages[0]) {\r\n          this._pageHeight = file.pages[0].height;\r\n          this._pageWidth = file.pages[0].width;\r\n          this.refreshZoom();\r\n        }\r\n        const preloadPageCount = this.preloadPageCountConfig;\r\n        const countPages = file.pages ? file.pages.length : 0;\r\n        if (preloadPageCount > 0) {\r\n          this.preloadPages(1, preloadPageCount > countPages ? countPages : preloadPageCount);\r\n        } else {\r\n          setTimeout(() => {\r\n            for (const page of this.file.pages) {\r\n              this.importAnnotations(page.annotations ? page.annotations : []);\r\n            }\r\n          }, 100);\r\n        }\r\n        this._navigateService.countPages = countPages;\r\n        this._navigateService.currentPage = 1;\r\n        this.countPages = countPages;\r\n      }\r\n    }\r\n    );\r\n    if (modalId) {\r\n      this._modalService.close(modalId);\r\n    }\r\n    this.clearData();\r\n  }\r\n\r\n  preloadPages(start: number, end: number) {\r\n    for (let i = start; i <= end; i++) {\r\n      this._annotationService.loadPage(this.credentials, i).subscribe((page: PageAnnotationModel) => {\r\n        this.file.pages[i - 1] = page;\r\n        setTimeout(() => {\r\n          this.importAnnotations(page.annotations ? page.annotations : []);\r\n        }, 100);\r\n      });\r\n    }\r\n  }\r\n\r\n  private importAnnotations(annotations: AnnotationData[]) {\r\n    for (const annotation of annotations) {\r\n      const position = new Position(annotation.left, annotation.top);\r\n      const id = this.addAnnotationComponent(annotation.pageNumber, position, annotation);\r\n      this.comments.set(id, annotation.comments);\r\n      this._activeAnnotationService.changeActive(id);\r\n    }\r\n  }\r\n\r\n  upload($event: string) {\r\n    this._annotationService.upload(null, $event, this.rewriteConfig).subscribe(() => {\r\n      this.selectDir('');\r\n    });\r\n  }\r\n\r\n  onRightClick($event: MouseEvent) {\r\n    return this.enableRightClickConfig;\r\n  }\r\n\r\n  downloadFile() {\r\n    if (this.formatDisabled)\r\n      return;\r\n    window.location.assign(this._annotationService.getDownloadUrl(this.credentials));\r\n  }\r\n\r\n  annotate() {\r\n    const annotationsData = this.prepareAnnotationsData();\r\n\r\n    this._annotationService.annotate(this.credentials, annotationsData, false).subscribe((ret: any) => {\r\n      this._modalService.open(CommonModals.OperationSuccess);\r\n      this.selectFile(ret.guid, this.credentials.password, CommonModals.OperationSuccess);\r\n    });\r\n  }\r\n\r\n  public prepareAnnotationsData() {\r\n    const annotationsData = [];\r\n    for (const annotation of this.annotations.values()) {\r\n      const annotationData = (<AnnotationComponent>annotation.instance).getAnnotationData();\r\n      annotationData.comments = this.comments.get(annotationData.id);\r\n      annotationsData.push(annotationData);\r\n    }\r\n    return annotationsData;\r\n  }\r\n\r\n  isVisible(id: string) {\r\n    const supported = !this.file || (this.file && this.file.supportedAnnotations &&\r\n      this.file.supportedAnnotations.find(function (value: string) {\r\n        return id === value;\r\n      }));\r\n    return this.getAnnotationTypeConfig(id) && supported;\r\n  }\r\n\r\n  activeTab($event) {\r\n    if (this.activeAnnotationTab && $event === this.activeAnnotationTab) {\r\n      this.activeAnnotationTab = null;\r\n    } else {\r\n      this.activeAnnotationTab = $event;\r\n    }\r\n  }\r\n\r\n  codesConfigFirst() {\r\n    return this.checkConfig(this.annotationTypeFirst);\r\n  }\r\n\r\n  codesConfigSecond() {\r\n    return this.checkConfig(this.annotationTypeSecond);\r\n  }\r\n\r\n  private checkConfig(annotationList) {\r\n    for (const annotationType of annotationList) {\r\n      if (this.getAnnotationTypeConfig(annotationType.id)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  codesConfigThird() {\r\n    return this.getAnnotationTypeConfig(AnnotationType.TEXT_FIELD.id) && this.getAnnotationTypeConfig(AnnotationType.WATERMARK.id);\r\n  }\r\n\r\n  private getAnnotationTypeConfig(id: string) {\r\n    switch (id) {\r\n      case AnnotationType.TEXT.id:\r\n        return this.textAnnotationConfig;\r\n      case AnnotationType.AREA.id:\r\n        return this.areaAnnotationConfig;\r\n      case AnnotationType.POINT.id:\r\n        return this.pointAnnotationConfig;\r\n      case AnnotationType.TEXT_STRIKEOUT.id:\r\n        return this.textStrikeoutAnnotationConfig;\r\n      case AnnotationType.POLYLINE.id:\r\n        return this.polylineAnnotationConfig;\r\n      case AnnotationType.TEXT_FIELD.id:\r\n        return this.textFieldAnnotationConfig;\r\n      case AnnotationType.WATERMARK.id:\r\n        return this.watermarkAnnotationConfig;\r\n      case AnnotationType.TEXT_REPLACEMENT.id:\r\n        return this.textReplacementAnnotationConfig;\r\n      case AnnotationType.ARROW.id:\r\n        return this.arrowAnnotationConfig;\r\n      case AnnotationType.TEXT_REDACTION.id:\r\n        return this.textRedactionAnnotationConfig;\r\n      case AnnotationType.TEXT_UNDERLINE.id:\r\n        return this.textUnderlineAnnotationConfig;\r\n      case AnnotationType.DISTANCE.id:\r\n        return this.distanceAnnotationConfig;\r\n    }\r\n  }\r\n\r\n  fileDropped($event) {\r\n    this.fileWasDropped = $event;\r\n  }\r\n\r\n  private cleanAnnotations() {\r\n    for (const componentRef of this.annotations.values()) {\r\n      componentRef.destroy();\r\n    }\r\n    this.annotations = new Map<number, ComponentRef<any>>();\r\n    this.comments = new Map<number, Comment[]>();\r\n  }\r\n\r\n  hideAnnotations() {\r\n    for (const annotationCompRef of this.annotations.values()) {\r\n      this.annotationsHidden = (<AnnotationComponent>annotationCompRef.instance).hidden = !(<AnnotationComponent>annotationCompRef.instance).hidden;\r\n    }\r\n  }\r\n\r\n  private clearData() {\r\n    if (!this.file || !this.file.pages) {\r\n      return;\r\n    }\r\n    for (const page of this.file.pages) {\r\n      page.data = null;\r\n    }\r\n  }\r\n\r\n  createAnnotation($event: any) {\r\n    if ($event.target.classList[0] === 'svg' || $event.target.classList[0] === 'gd-page-image') {\r\n      if (this.activeAnnotationTab) {\r\n        $event.preventDefault();\r\n      }\r\n\r\n      if (this.activeAnnotationTab) {\r\n        const position = Utils.getMousePosition($event);\r\n\r\n        const elements = document.elementsFromPoint(position.x, position.y);\r\n        const currentPage = elements.find(x => x.id && x.id.startsWith(\"page-\"));\r\n        if (currentPage) {\r\n          const documentPage = $(currentPage).parent().parent()[0];\r\n          const currentPosition = this.getCurrentPosition(position, $(documentPage));\r\n          const pageId = currentPage.id;\r\n          let pageNumber = 1;\r\n          if (pageId) {\r\n            const split = pageId.split('-');\r\n            pageNumber = split.length === 2 ? parseInt(split[1], 10) : pageNumber;\r\n          }\r\n          const id = this.addAnnotationComponent(pageNumber, currentPosition, null);\r\n          this._activeAnnotationService.changeActive(id);\r\n          this.creatingAnnotationId = id;\r\n          // this._tabActivatorService.changeActiveTab(null);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private addAnnotationComponent(pageNumber: number, currentPosition: Position, data: AnnotationData) {\r\n    const dynamicDirective = this._hostingComponentsService.find(pageNumber);\r\n    if (dynamicDirective) {\r\n      const viewContainerRef = dynamicDirective.viewContainerRef;\r\n      const annotationComponent = this._addDynamicComponentService.addDynamicComponent(viewContainerRef, AnnotationComponent);\r\n      const id = this.getNextId();\r\n      (<AnnotationComponent>annotationComponent.instance).id = id;\r\n      (<AnnotationComponent>annotationComponent.instance).position = currentPosition;\r\n      (<AnnotationComponent>annotationComponent.instance).pageNumber = pageNumber;\r\n      if (data) {\r\n        const dimension = new Dimension(data.width, data.height);\r\n        const type = AnnotationType.getAnnotationType(data.type);\r\n        const formatting = Formatting.default();\r\n        formatting.fontSize = data.fontSize;\r\n        if (data.fontColor) {\r\n          formatting.color = \"#\" + data.fontColor.toString(16);\r\n        }\r\n        formatting.font = data.font;\r\n        (<AnnotationComponent>annotationComponent.instance).type = type ? type.id : data.type;\r\n        (<AnnotationComponent>annotationComponent.instance).dimension = dimension;\r\n        (<AnnotationComponent>annotationComponent.instance).svgPath = data.svgPath;\r\n        (<AnnotationComponent>annotationComponent.instance).textValue = data.text;\r\n        if (formatting) {\r\n          (<AnnotationComponent>annotationComponent.instance).saveFormatting(formatting);\r\n        }\r\n      } else {\r\n        (<AnnotationComponent>annotationComponent.instance).type = this.activeAnnotationTab;\r\n      }\r\n      const pageModel = this.file.pages.find(function (p) {\r\n        return p.number === pageNumber;\r\n      });\r\n      (<AnnotationComponent>annotationComponent.instance).pageWidth = pageModel.width;\r\n      (<AnnotationComponent>annotationComponent.instance).pageHeight = pageModel.height;\r\n      (<AnnotationComponent>annotationComponent.instance).hidden = this.annotationsHidden;\r\n      this.annotations.set(id, annotationComponent);\r\n      return id;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  resizingCreatingAnnotation($event: MouseEvent) {\r\n    if (this.activeAnnotationTab) {\r\n      $event.preventDefault();\r\n    }\r\n\r\n    if (this.creatingAnnotationId) {\r\n      const position = Utils.getMousePosition($event);\r\n      const annotationComponent = this.annotations.get(this.creatingAnnotationId);\r\n      const type = (<AnnotationComponent>annotationComponent.instance).type;\r\n      const pageNumber = (<AnnotationComponent>annotationComponent.instance).pageNumber;\r\n      const currentPosition = this.getCurrentPosition(position, $(\"#page-\" + pageNumber));\r\n      if (type === AnnotationType.POLYLINE.id || type === AnnotationType.DISTANCE.id || type === AnnotationType.ARROW.id) {\r\n        (<AnnotationComponent>annotationComponent.instance).draw(currentPosition);\r\n      } else if (type !== AnnotationType.POINT.id) {\r\n        (<AnnotationComponent>annotationComponent.instance).calcDimensions(currentPosition);\r\n      }\r\n    }\r\n  }\r\n\r\n  private getCurrentPosition(position, page) {\r\n    const left = (position.x - page.offset().left) / (this.zoom / 100);\r\n    const top = (position.y - page.offset().top) / (this.zoom / 100);\r\n    return new Position(left, top);\r\n  }\r\n\r\n  finishCreatingAnnotation($event: MouseEvent) {\r\n    if (this.activeAnnotationTab) {\r\n      $event.preventDefault();\r\n    }\r\n\r\n    if (this.creatingAnnotationId) {\r\n      this._activeAnnotationService.changeActive(this.creatingAnnotationId);\r\n      this.creatingAnnotationId = null;\r\n    }\r\n  }\r\n\r\n  closeComments() {\r\n    this.commentOpenedId = null;\r\n  }\r\n\r\n  onPan($event) {\r\n    this._zoomService.changeZoom(this._zoom);\r\n  }\r\n\r\n  private getNextId() {\r\n    let maxId = 0;\r\n    for (const annId of this.annotations.keys()) {\r\n      if (annId > maxId) {\r\n        maxId = annId;\r\n      }\r\n    }\r\n    const id = maxId + 1;\r\n    return id;\r\n  }\r\n}\r\n","import {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\r\nimport {CommentAnnotationService} from \"../comment-annotation.service\";\r\nimport {Comment} from '../annotation-models'\r\n\r\n@Component({\r\n  selector: 'gd-comment-panel',\r\n  templateUrl: './comment-panel.component.html',\r\n  styleUrls: ['./comment-panel.component.less']\r\n})\r\nexport class CommentPanelComponent implements OnInit {\r\n  @Input() comments: [];\r\n  @Input() annotationId: number;\r\n\r\n  @Output() closeComments = new EventEmitter<boolean>();\r\n\r\n  currentComment: Comment;\r\n\r\n  constructor(private _commentAnnotationService: CommentAnnotationService) {\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  closePanel() {\r\n    this.closeComments.emit(true);\r\n  }\r\n\r\n  newComment() {\r\n    this.currentComment = new Comment(this.annotationId);\r\n  }\r\n\r\n  clearComment() {\r\n    this.currentComment = null;\r\n  }\r\n\r\n  addComment() {\r\n    this._commentAnnotationService.addComment(Comment.create(this.currentComment));\r\n    this.currentComment = null;\r\n  }\r\n}\r\n","import {Component, Input, OnInit} from '@angular/core';\r\nimport {Comment} from '../annotation-models'\r\n\r\n@Component({\r\n  selector: 'gd-comment',\r\n  templateUrl: './comment.component.html',\r\n  styleUrls: ['./comment.component.less']\r\n})\r\nexport class CommentComponent implements OnInit {\r\n\r\n  @Input() comment: Comment;\r\n\r\n  constructor() {\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  getTime() {\r\n    const time = Date.now() - this.comment.time;\r\n    const hours = Math.round(time / (60 * 60 * 1000));\r\n    if (hours > 1) {\r\n      return 'about ' + hours + ' hours ago';\r\n    }\r\n    const min = Math.round(time / (60 * 1000));\r\n    if (min > 1) {\r\n      return 'about ' + min + ' minutes ago';\r\n    }\r\n    const sec = Math.round(time / 1000);\r\n    if (sec > 1) {\r\n      return 'about ' + sec + ' seconds ago';\r\n    }\r\n    return this.comment.time;\r\n  }\r\n}\r\n","import {Component, EventEmitter, Input, OnInit, Output} from '@angular/core';\r\nimport {Comment} from '../annotation-models'\r\nimport * as jquery from 'jquery';\r\n\r\nconst $ = jquery;\r\n\r\n@Component({\r\n  selector: 'gd-create-comment',\r\n  templateUrl: './create-comment.component.html',\r\n  styleUrls: ['./create-comment.component.less']\r\n})\r\nexport class CreateCommentComponent implements OnInit {\r\n  @Input() comment: Comment;\r\n\r\n  @Output() addComment = new EventEmitter<Comment>();\r\n  @Output() removeComment = new EventEmitter<boolean>();\r\n\r\n  constructor() {\r\n  }\r\n\r\n  ngOnInit() {\r\n    setTimeout(() => {\r\n      const element = $(\"#name\");\r\n      if (element) {\r\n        element.focus();\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  onAddComment() {\r\n    this.addComment.emit(this.comment);\r\n  }\r\n\r\n  clearComment() {\r\n    this.removeComment.emit(true);\r\n  }\r\n\r\n  saveText(value: string) {\r\n    this.comment.text = value;\r\n  }\r\n\r\n  saveName(value: string) {\r\n    this.comment.userName = value;\r\n  }\r\n}\r\n","import {APP_INITIALIZER, ModuleWithProviders, NgModule} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\nimport {\r\n  Api,\r\n  CommonComponentsModule,\r\n  ConfigService,\r\n  ErrorInterceptorService, LoadingMaskInterceptorService, LoadingMaskService\r\n} from \"@groupdocs.examples.angular/common-components\";\r\nimport {AnnotationConfigService} from \"./annotation-config.service\";\r\nimport {HTTP_INTERCEPTORS, HttpClientModule} from \"@angular/common/http\";\r\nimport {FontAwesomeModule} from \"@fortawesome/angular-fontawesome\";\r\nimport {ClickOutsideModule} from \"ng-click-outside\";\r\nimport {AnnotationAppComponent} from './annotation-app.component';\r\nimport {library} from \"@fortawesome/fontawesome-svg-core\";\r\nimport {fas} from \"@fortawesome/free-solid-svg-icons\";\r\nimport {far} from \"@fortawesome/free-regular-svg-icons\";\r\nimport {AnnotationComponent} from './annotation/annotation.component';\r\nimport {ActiveAnnotationService} from \"./active-annotation.service\";\r\nimport {RemoveAnnotationService} from \"./remove-annotation.service\";\r\nimport {CommentAnnotationService} from \"./comment-annotation.service\";\r\nimport {CommentPanelComponent} from './comment-panel/comment-panel.component';\r\nimport {CommentComponent} from './comment/comment.component';\r\nimport {CreateCommentComponent} from './create-comment/create-comment.component';\r\nimport {TranslateModule} from '@ngx-translate/core';\r\n\r\nexport function initializeApp(annotationConfigService: AnnotationConfigService) {\r\n  const result = () => annotationConfigService.load();\r\n  return result;\r\n}\r\n\r\n// NOTE: this is required during library compilation see https://github.com/angular/angular/issues/23629#issuecomment-440942981\r\n// @dynamic\r\nexport function setupLoadingInterceptor(service: LoadingMaskService) {\r\n  return new LoadingMaskInterceptorService(service);\r\n}\r\n\r\n@NgModule({\r\n  declarations: [AnnotationAppComponent, AnnotationComponent, CommentPanelComponent, CommentComponent, CreateCommentComponent,\r\n  ],\r\n  exports: [CommonComponentsModule, AnnotationAppComponent, AnnotationComponent, CommentPanelComponent, CommentComponent, CreateCommentComponent],\r\n  imports:\r\n    [CommonModule,\r\n      CommonComponentsModule,\r\n      HttpClientModule,\r\n      FontAwesomeModule,\r\n      ClickOutsideModule,\r\n      TranslateModule.forRoot()\r\n    ],\r\n  providers:\r\n    [\r\n      ConfigService,\r\n      AnnotationConfigService,\r\n      ActiveAnnotationService,\r\n      RemoveAnnotationService,\r\n      CommentAnnotationService,\r\n      {\r\n        provide: HTTP_INTERCEPTORS,\r\n        useClass: ErrorInterceptorService,\r\n        multi: true\r\n      },\r\n      {\r\n        provide: APP_INITIALIZER,\r\n        useFactory: initializeApp,\r\n        deps: [AnnotationConfigService], multi: true\r\n      },\r\n      LoadingMaskService,\r\n      {\r\n        provide: HTTP_INTERCEPTORS,\r\n        useFactory: setupLoadingInterceptor,\r\n        multi: true,\r\n        deps: [LoadingMaskService]\r\n      }\r\n    ],\r\n  entryComponents: [AnnotationComponent],\r\n})\r\n\r\nexport class AnnotationModule {\r\n  constructor() {\r\n    library.add(fas, far);\r\n  }\r\n\r\n  static forRoot(apiEndpoint: string): ModuleWithProviders {\r\n    Api.DEFAULT_API_ENDPOINT = apiEndpoint;\r\n    return {\r\n      ngModule: AnnotationModule\r\n    };\r\n  }\r\n}\r\n"]}